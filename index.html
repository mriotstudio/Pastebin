<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Animated progress bars */
        .progress-bar {
            transition: width 1.5s ease-in-out;
        }
        
        /* Glassmorphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        /* Floating animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Pulse animation for icons */
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.6); }
        }
        
        .pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg border-b-4 border-blue-500">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-lg font-bold text-gray-800">üèóÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</h1>
                    </div>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden lg:flex items-center space-x-2">
                    <button id="adminBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üîß ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
                    </button>
                    <button id="dashboardBtn" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üìà ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    </button>
                    <button id="generateLinkBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üîó ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Ñ‡πå
                    </button>
                    <button id="previewExcelBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üëÅÔ∏è ‡∏î‡∏π Excel
                    </button>
                    <button id="backupExcelBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üíæ ‡∏™‡∏≥‡∏£‡∏≠‡∏á Excel
                    </button>
                    <input type="file" id="importExcelInput" accept=".xlsx,.xls" class="hidden">
                    <button id="importExcelBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ Excel
                    </button>
                    <button id="previewPDFBtn" class="bg-amber-600 hover:bg-amber-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üëÅÔ∏è ‡∏î‡∏π PDF
                    </button>
                    <button id="exportPDFBtn" class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üìÑ ‡πÄ‡∏ã‡∏ü PDF
                    </button>
                    <button id="clearDataBtn" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg font-medium transition-colors text-sm">
                        üóëÔ∏è ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="lg:hidden">
                    <button id="mobileMenuBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg">
                        ‚ò∞ ‡πÄ‡∏°‡∏ô‡∏π
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden lg:hidden pb-4">
                <div class="grid grid-cols-2 gap-2">
                    <button id="adminBtnMobile" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-medium text-sm">
                        üîß ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô
                    </button>
                    <button id="dashboardBtnMobile" class="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg font-medium text-sm">
                        üìà ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                    </button>
                    <button id="generateLinkBtnMobile" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg font-medium text-sm">
                        üîó ‡∏•‡∏¥‡∏á‡∏Ñ‡πå
                    </button>
                    <button id="previewExcelBtnMobile" class="bg-emerald-600 hover:bg-emerald-700 text-white px-3 py-2 rounded-lg font-medium text-sm">
                        üëÅÔ∏è Excel
                    </button>
                    <button id="backupExcelBtnMobile" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg font-medium text-sm">
                        üíæ ‡∏™‡∏≥‡∏£‡∏≠‡∏á
                    </button>
                    <button id="importExcelBtnMobile" class="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg font-medium text-sm">
                        üì• ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤
                    </button>
                    <button id="previewPDFBtnMobile" class="bg-amber-600 hover:bg-amber-700 text-white px-3 py-2 rounded-lg font-medium text-sm">
                        üëÅÔ∏è PDF
                    </button>
                    <button id="exportPDFBtnMobile" class="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg font-medium text-sm">
                        üìÑ PDF
                    </button>
                    <button id="clearDataBtnMobile" class="bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg font-medium text-sm">
                        üóëÔ∏è ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Link Generator Modal -->
    <div id="linkModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 text-center">üîó ‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</h3>
            <div class="bg-blue-50 p-4 rounded-lg mb-4 border-l-4 border-blue-400">
                <div class="flex items-start mb-3">
                    <div class="text-blue-600 mr-2 text-lg">üî¥</div>
                    <div>
                        <h4 class="font-semibold text-blue-800 mb-1">‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå</h4>
                        <p class="text-sm text-blue-700">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å!</p>
                    </div>
                </div>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg mb-4">
                <p class="text-sm text-gray-600 mb-2">‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏î‡∏π‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤:</p>
                <div class="flex items-center space-x-2">
                    <input type="text" id="clientLink" readonly class="flex-1 px-3 py-2 bg-white border border-gray-300 rounded-md text-sm" value="">
                    <button id="copyLinkBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-md text-sm">
                        üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å
                    </button>
                </div>
                <div class="mt-2 text-xs text-green-600">
                    üî¥ ‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå - ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
                </div>
            </div>
            <div class="flex justify-center">
                <button id="closeLinkModal" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                    ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>

    <!-- Excel Preview Modal -->
    <div id="excelPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-gray-800">üìä ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå Excel</h3>
                <button id="closeExcelPreview" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg mb-4 overflow-auto max-h-[70vh]">
                <div id="excelPreviewContent" class="text-sm">
                    <!-- Excel preview content will be generated here -->
                </div>
            </div>
            <div class="flex justify-center space-x-3">
                <button id="downloadExcelFromPreview" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg">
                    üìä ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î Excel
                </button>
                <button id="closeExcelPreviewBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                    ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>

    <!-- PDF Preview Modal -->
    <div id="pdfPreviewModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-6 max-w-6xl w-full mx-4 max-h-[90vh] overflow-hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-gray-800">üìÑ ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF</h3>
                <button id="closePDFPreview" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
            </div>
            <div class="bg-gray-50 p-4 rounded-lg mb-4 overflow-auto max-h-[70vh]">
                <div id="pdfPreviewContent" class="space-y-4">
                    <!-- PDF preview content will be generated here -->
                </div>
            </div>
            <div class="flex justify-center space-x-3">
                <button id="downloadPDFFromPreview" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-2 rounded-lg">
                    üìÑ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î PDF
                </button>
                <button id="closePDFPreviewBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg">
                    ‡∏õ‡∏¥‡∏î
                </button>
            </div>
        </div>
    </div>

    <!-- Clear Data Confirmation Modal -->
    <div id="clearDataModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full mx-4">
            <div class="text-center mb-6">
                <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                <h3 class="text-2xl font-bold text-red-600 mb-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                <p class="text-gray-700 mb-4">‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ!</p>
            </div>
            
            <div class="bg-red-50 p-4 rounded-lg mb-6 border-l-4 border-red-400">
                <p class="text-sm text-red-800 mb-3">
                    <strong>‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</strong> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö
                </p>
                <p class="text-sm text-red-700">
                    ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô: <strong class="text-red-600">DELETE123</strong>
                </p>
            </div>
            
            <div class="mb-6">
                <input type="password" id="clearPasswordInput" placeholder="‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô" 
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 text-center">
                <div id="passwordError" class="text-red-500 text-sm mt-2 hidden">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!</div>
            </div>
            
            <div class="flex space-x-3">
                <button id="cancelClearBtn" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-medium">
                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                </button>
                <button id="confirmClearBtn" class="flex-1 bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium">
                    ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="w-full px-2 sm:px-4 lg:px-6 py-3 sm:py-4 lg:py-6">
        <!-- Company Information Section -->
        <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6 lg:p-8 mb-8">
            <div class="text-center mb-6">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">üè¢ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</h2>
                <div class="bg-purple-50 p-3 sm:p-4 rounded-lg border-l-4 border-purple-400">
                    <p class="text-sm sm:text-base text-purple-800">
                        <strong>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</strong> ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                    </p>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Company Logo Upload -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üì∑ ‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</h3>
                    <div class="space-y-4">
                        <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                            <div id="logoPreview" class="mb-4">
                                <div class="w-32 h-32 mx-auto bg-gray-200 rounded-lg flex items-center justify-center">
                                    <span class="text-gray-500 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏•‡πÇ‡∏Å‡πâ</span>
                                </div>
                            </div>
                            <input type="file" id="logoInput" accept="image/*" class="hidden">
                            <button onclick="document.getElementById('logoInput').click()" 
                                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm">
                                üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏•‡πÇ‡∏Å‡πâ
                            </button>
                            <p class="text-xs text-gray-500 mt-2">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö: JPG, PNG, GIF (‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2MB)</p>
                        </div>
                        <button id="removeLogoBtn" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg text-sm hidden">
                            üóëÔ∏è ‡∏•‡∏ö‡πÇ‡∏•‡πÇ‡∏Å‡πâ
                        </button>
                    </div>
                </div>
                
                <!-- Company Details -->
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</label>
                            <input type="text" id="companyName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó ‡∏à‡∏≥‡∏Å‡∏±‡∏î" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</label>
                            <input type="text" id="projectName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>

                    </div>
                </div>
            </div>
            
            <div class="flex justify-center mt-6">
                <button id="saveCompanyInfo" class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all">
                    üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó
                </button>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-xl p-4 sm:p-6 lg:p-8 mb-8">
            <div class="text-center mb-6 lg:mb-8">
                <h2 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">üîß ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                <div class="bg-blue-50 p-3 sm:p-4 rounded-lg border-l-4 border-blue-400">
                    <p class="text-sm sm:text-base text-blue-800">
                        <strong>‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô:</strong> ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô
                    </p>
                </div>
                <div class="bg-green-50 p-3 sm:p-4 rounded-lg border-l-4 border-green-400 mt-3">
                    <div class="flex items-start">
                        <div class="text-green-600 mr-2 text-lg">üî¥</div>
                        <div>
                            <p class="text-sm sm:text-base text-green-800">
                                <strong>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå:</strong> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡∏•‡∏¥‡∏á‡∏Ñ‡πå‡πÉ‡∏´‡∏°‡πà
                            </p>
                            <p class="text-xs sm:text-sm text-green-700 mt-1">
                                ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏±‡∏ô‡πÑ‡∏î‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 lg:gap-8">
                <!-- Input Form -->
                <div class="lg:col-span-3 space-y-4 lg:space-y-6">
                    <div class="bg-blue-50 p-4 sm:p-6 rounded-lg">
                        <h3 class="text-lg sm:text-xl font-semibold text-blue-800 mb-4">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</h3>
                        <div class="space-y-3 sm:space-y-4" id="workItems">
                            <!-- Work items will be generated here -->
                        </div>
                    </div>
                    
                    <div class="flex justify-center">
                        <button id="updateProgress" class="w-full sm:w-auto bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-6 sm:px-8 py-3 rounded-lg font-semibold text-base sm:text-lg shadow-lg transform hover:scale-105 transition-all">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </button>
                    </div>
                </div>

                <!-- Progress Summary -->
                <div class="lg:col-span-1 bg-gradient-to-br from-green-50 to-blue-50 p-4 sm:p-6 rounded-lg">
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-800 mb-4">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</h3>
                    <div class="bg-yellow-50 p-3 sm:p-4 rounded-lg mb-4 border-l-4 border-yellow-400">
                        <p class="text-xs sm:text-sm text-yellow-800">
                            <strong>‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:</strong> ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </p>
                    </div>
                    <div id="progressSummary" class="space-y-2 sm:space-y-3 max-h-[600px] sm:max-h-[700px] overflow-y-auto">
                        <!-- Progress summary will be shown here -->
                    </div>
                    <div class="mt-4 sm:mt-6 p-3 sm:p-4 bg-white rounded-lg shadow-md">
                        <div class="text-center">
                            <div class="text-2xl sm:text-3xl font-bold text-green-600" id="totalProgress">0.00%</div>
                            <div class="text-sm sm:text-base text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</div>
                            <div class="text-xs sm:text-sm text-gray-500 mt-2">
                                ‡∏à‡∏≤‡∏Å <span id="totalDays">0</span> ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Client Dashboard -->
    <div id="dashboard" class="w-full px-2 sm:px-4 py-3 sm:py-4 hidden">


        <!-- Header Section with Dashboard Title -->
        <div class="bg-gradient-to-br from-indigo-600 via-purple-600 to-blue-700 rounded-2xl shadow-2xl p-4 sm:p-6 mb-6 text-white relative overflow-hidden">
            <!-- Decorative Elements -->
            <div class="absolute top-0 right-0 w-32 h-32 bg-white opacity-10 rounded-full -translate-y-16 translate-x-16"></div>
            <div class="absolute bottom-0 left-0 w-24 h-24 bg-white opacity-5 rounded-full translate-y-12 -translate-x-12"></div>
            
            <div class="relative z-10">
                <!-- Company Information Section -->
                <div class="flex flex-col lg:flex-row items-center justify-between mb-6">
                    <!-- Company Logo and Info -->
                    <div class="flex items-center gap-4 mb-4 lg:mb-0">
                        <div id="dashboardLogo" class="w-16 h-16 bg-white bg-opacity-20 rounded-xl flex items-center justify-center border-2 border-white border-opacity-30 shadow-lg backdrop-blur-sm">
                            <span class="text-white text-xs">‡πÇ‡∏•‡πÇ‡∏Å‡πâ</span>
                        </div>
                        <div class="text-center lg:text-left">
                            <h3 id="dashboardCompanyName" class="text-lg font-bold text-white">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó</h3>
                            <h4 id="dashboardProjectName" class="text-sm text-indigo-100 font-medium">‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h4>
                        </div>
                    </div>
                    
                    <!-- Dashboard Icon -->
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-white bg-opacity-20 rounded-full backdrop-blur-sm shadow-lg">
                        <span class="text-2xl">üìä</span>
                    </div>
                </div>
                
                <!-- Dashboard Title and Info -->
                <div class="text-center">
                    <h2 class="text-xl sm:text-2xl xl:text-3xl font-bold mb-2">‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h2>
                    <p class="text-sm text-indigo-100 mb-4">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ - ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="lastUpdate" class="font-semibold text-white"></span></p>
                    
                    <div class="flex flex-col sm:flex-row justify-center items-center gap-3">
                        <div class="text-xs bg-white bg-opacity-20 backdrop-blur-sm px-4 py-2 rounded-full border border-white border-opacity-30 flex items-center shadow-md">
                            <span class="mr-2">üîí</span>
                            <span>‡πÇ‡∏´‡∏°‡∏î‡∏î‡∏π‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß - ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</span>
                        </div>
                        <button id="refreshDataBtn" class="text-xs bg-emerald-500 hover:bg-emerald-600 text-white px-4 py-2 rounded-full transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center border border-emerald-400 border-opacity-30">
                            <span class="mr-2">üîÑ</span>
                            <span>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards with Enhanced Design -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <!-- Total Progress Card -->
            <div class="group bg-gradient-to-br from-blue-500 to-blue-700 text-white p-4 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-white opacity-10 rounded-full -translate-y-10 translate-x-10"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-2">
                        <div class="p-2 bg-white bg-opacity-20 rounded-lg backdrop-blur-sm">
                            <span class="text-2xl">üéØ</span>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-blue-100 uppercase tracking-wide">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°</p>
                            <p class="text-2xl font-bold" id="dashTotalProgress">0.00%</p>
                        </div>
                    </div>
                    <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
                        <div class="bg-white h-2 rounded-full transition-all duration-1000" style="width: 0%" id="totalProgressBar"></div>
                    </div>
                </div>
            </div>
            
            <!-- Completed Tasks Card -->
            <div class="group bg-gradient-to-br from-emerald-500 to-green-700 text-white p-4 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-white opacity-10 rounded-full -translate-y-10 translate-x-10"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-2">
                        <div class="p-2 bg-white bg-opacity-20 rounded-lg backdrop-blur-sm">
                            <span class="text-2xl">‚úÖ</span>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-green-100 uppercase tracking-wide">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</p>
                            <p class="text-2xl font-bold" id="completedTasks">0</p>
                        </div>
                    </div>
                    <p class="text-xs text-green-100">‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 7 ‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</p>
                </div>
            </div>
            
            <!-- In Progress Tasks Card -->
            <div class="group bg-gradient-to-br from-amber-500 to-orange-700 text-white p-4 rounded-2xl shadow-xl hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 relative overflow-hidden">
                <div class="absolute top-0 right-0 w-20 h-20 bg-white opacity-10 rounded-full -translate-y-10 translate-x-10"></div>
                <div class="relative z-10">
                    <div class="flex items-center justify-between mb-2">
                        <div class="p-2 bg-white bg-opacity-20 rounded-lg backdrop-blur-sm">
                            <span class="text-2xl">üîÑ</span>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-orange-100 uppercase tracking-wide">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</p>
                            <p class="text-2xl font-bold" id="inProgressTasks">7</p>
                        </div>
                    </div>
                    <p class="text-xs text-orange-100">‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</p>
                </div>
            </div>
        </div>

        <!-- Overall Progress Chart Section -->
        <div class="bg-white rounded-2xl shadow-xl p-4 sm:p-6 mb-6 border border-gray-100">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-12 h-12 bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl mb-3">
                    <span class="text-white text-xl">üìà</span>
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">‡∏Å‡∏£‡∏≤‡∏ü‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</h3>
                <p class="text-sm text-gray-600">‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</p>
            </div>
            
            <div class="bg-gradient-to-br from-gray-50 to-blue-50 p-4 rounded-xl border border-gray-200">
                <div class="flex flex-col lg:flex-row items-center justify-center gap-6">
                    <div class="relative">
                        <div class="w-56 h-56 relative">
                            <canvas id="overallChart" width="224" height="224"></canvas>
                            <!-- Center decoration -->
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <div class="w-16 h-16 bg-white rounded-full shadow-lg flex items-center justify-center">
                                    <span class="text-2xl">üèóÔ∏è</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="w-full lg:w-auto">
                        <div class="grid grid-cols-1 gap-2" id="chartLegend">
                            <!-- Legend will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Individual Progress Charts Section -->
        <div class="bg-white rounded-2xl shadow-xl p-4 sm:p-6 mb-6 border border-gray-100">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl mb-3">
                    <span class="text-white text-xl">üéØ</span>
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</h3>
                <p class="text-sm text-gray-600">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</p>
            </div>
            
            <div class="bg-gradient-to-br from-gray-50 to-purple-50 p-4 rounded-xl border border-gray-200">
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-7 gap-3" id="individualCharts">
                    <!-- Individual pie charts will be generated here -->
                </div>
            </div>
        </div>

        <!-- Detailed Progress Section -->
        <div class="bg-white rounded-2xl shadow-xl p-4 sm:p-6 border border-gray-100">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-12 h-12 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-xl mb-3">
                    <span class="text-white text-xl">üìã</span>
                </div>
                <h3 class="text-lg font-bold text-gray-800 mb-2">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î</h3>
                <p class="text-sm text-gray-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</p>
            </div>
            
            <div class="bg-gradient-to-br from-gray-50 to-teal-50 p-4 rounded-xl border border-gray-200">
                <div id="detailedProgress" class="space-y-3 max-h-80 overflow-y-auto custom-scrollbar">
                    <!-- Detailed progress will be shown here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Work items data
        const workItems = [
            { 
                id: 1, 
                name: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (Unseen Work)",
                fullName: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á (Unseen Work) - ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏£‡∏∑‡πâ‡∏≠‡∏ñ‡∏≠‡∏ô ‡∏á‡∏≤‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏Å",
                totalWeeks: 43,
                percentPerWeek: 0.54,
                maxPercent: 23.22
            },
            { 
                id: 2, 
                name: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ü‡∏¥‡∏ï‡πÄ‡∏ô‡∏™",
                fullName: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ü‡∏¥‡∏ï‡πÄ‡∏ô‡∏™ - ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ ‡∏á‡∏≤‡∏ô‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á ‡πÄ‡∏™‡∏µ‡∏¢‡∏á ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏£‡∏±‡∏ö‡∏≠‡∏≤‡∏Å‡∏≤‡∏®",
                totalWeeks: 15,
                percentPerWeek: 0.95,
                maxPercent: 14.25
            },
            { 
                id: 3, 
                name: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á",
                fullName: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á - ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ ‡∏´‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÅ‡∏Ç‡∏Å ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡πÄ‡∏•‡πà‡∏ô ‡∏á‡∏≤‡∏ô‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏†‡∏≤‡∏¢‡πÉ‡∏ô ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏î‡∏™‡∏ß‡∏ô",
                totalWeeks: 30,
                percentPerWeek: 1.01,
                maxPercent: 30.30
            },
            { 
                id: 4, 
                name: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡πÇ‡∏ñ‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô",
                fullName: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡πÇ‡∏ñ‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô - ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô ‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á ‡∏ö‡∏±‡∏ô‡πÑ‡∏î ‡∏á‡∏≤‡∏ô‡∏û‡∏∑‡πâ‡∏ô ‡∏ú‡∏ô‡∏±‡∏á ‡πÄ‡∏û‡∏î‡∏≤‡∏ô ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≤‡∏¢‡∏ö‡∏≠‡∏Å‡∏ó‡∏≤‡∏á",
                totalWeeks: 19,
                percentPerWeek: 0.93,
                maxPercent: 17.67
            },
            { 
                id: 5, 
                name: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ",
                fullName: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏•‡∏≤‡∏ô‡∏à‡∏≠‡∏î‡∏£‡∏ñ - ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ú‡∏¥‡∏ß ‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡πâ‡∏ô‡∏à‡∏£‡∏≤‡∏à‡∏£ ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ ‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏à‡∏£‡∏≤‡∏à‡∏£",
                totalWeeks: 13,
                percentPerWeek: 0.13,
                maxPercent: 1.69
            },
            { 
                id: 6, 
                name: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πÑ‡∏ü",
                fullName: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πÑ‡∏ü - ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡∏´‡∏ô‡∏µ‡πÑ‡∏ü ‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡∏ô‡∏µ‡πÑ‡∏ü ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ‡∏á‡∏≤‡∏ô‡∏õ‡πâ‡∏≤‡∏¢‡∏ö‡∏≠‡∏Å‡∏ó‡∏≤‡∏á‡∏´‡∏ô‡∏µ‡πÑ‡∏ü ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏†‡∏±‡∏¢",
                totalWeeks: 21,
                percentPerWeek: 0.35,
                maxPercent: 7.35
            },
            { 
                id: 7, 
                name: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£",
                fullName: "‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ - ‡∏£‡∏ß‡∏°‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏ú‡∏ô‡∏±‡∏á‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å ‡∏á‡∏≤‡∏ô‡∏ó‡∏≤‡∏™‡∏µ ‡∏á‡∏≤‡∏ô‡∏ã‡πà‡∏≠‡∏°‡∏´‡∏•‡∏±‡∏á‡∏Ñ‡∏≤ ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏ô‡πâ‡∏≥ ‡πÅ‡∏•‡∏∞‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏†‡∏π‡∏°‡∏¥‡∏ó‡∏±‡∏®‡∏ô‡πå‡∏£‡∏≠‡∏ö‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£",
                totalWeeks: 26,
                percentPerWeek: 0.22,
                maxPercent: 5.72
            }
        ];

        let progressData = {};
        let overallChart = null;
        let individualCharts = [];
        let companyData = {
            logo: null,
            name: '',
            projectName: ''
        };

        // Initialize
        function initializeApp() {
            console.log('üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö...');
            
            loadProgressData();
            loadCompanyData();
            generateWorkItems();
            setupEventListeners();
            updateProgressSummary();
            updateLastUpdateTime();
            updateCompanyDisplay();
            
            // Show data load status
            const hasData = Object.keys(progressData).length > 0;
            const hasCompanyData = companyData.name || companyData.projectName || companyData.logo;
            
            if (hasData || hasCompanyData) {
                console.log('‚úÖ ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ - ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
                showDataLoadStatus('‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ - ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            } else {
                console.log('üìù ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà');
                showDataLoadStatus('‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà - ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô', 'info');
            }
            
            // Check URL parameters for client view
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('view') === 'client') {
                showClientDashboard();
            } else {
                updateDashboard();
            }
        }
        
        function showDataLoadStatus(message, type) {
            const statusDiv = document.createElement('div');
            statusDiv.className = `fixed top-4 left-4 px-4 py-2 rounded-lg shadow-lg z-50 text-sm transform -translate-x-full transition-transform duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'info' ? 'bg-blue-500 text-white' : 
                'bg-gray-500 text-white'
            }`;
            statusDiv.innerHTML = `${type === 'success' ? '‚úÖ' : 'üìù'} ${message}`;
            document.body.appendChild(statusDiv);
            
            // Show status
            setTimeout(() => {
                statusDiv.classList.remove('-translate-x-full');
            }, 100);
            
            // Hide after 3 seconds
            setTimeout(() => {
                statusDiv.classList.add('-translate-x-full');
                setTimeout(() => {
                    document.body.removeChild(statusDiv);
                }, 300);
            }, 3000);
        }

        // Setup event listeners
        function setupEventListeners() {
            // Navigation - Desktop
            document.getElementById('adminBtn').addEventListener('click', function() {
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('hidden');
            });
            
            document.getElementById('dashboardBtn').addEventListener('click', function() {
                document.getElementById('adminPanel').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                updateDashboard();
            });
            
            // Navigation - Mobile
            document.getElementById('adminBtnMobile').addEventListener('click', function() {
                document.getElementById('adminPanel').classList.remove('hidden');
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('mobileMenu').classList.add('hidden');
            });
            
            document.getElementById('dashboardBtnMobile').addEventListener('click', function() {
                document.getElementById('adminPanel').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('mobileMenu').classList.add('hidden');
                updateDashboard();
            });
            
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('mobileMenu').classList.toggle('hidden');
            });
            
            // Other buttons
            document.getElementById('generateLinkBtn').addEventListener('click', generateShareableLink);
            document.getElementById('generateLinkBtnMobile').addEventListener('click', generateShareableLink);
            
            // Refresh button for client view
            const refreshBtn = document.getElementById('refreshDataBtn');
            if (refreshBtn) {
                refreshBtn.addEventListener('click', function() {
                    const button = this;
                    const originalText = button.innerHTML;
                    
                    button.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä...';
                    button.disabled = true;
                    
                    loadProgressData();
                    updateDashboard();
                    updateAllCharts();
                    updateLastUpdateTime();
                    
                    setTimeout(() => {
                        button.innerHTML = '‚úÖ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÅ‡∏•‡πâ‡∏ß!';
                        setTimeout(() => {
                            button.innerHTML = originalText;
                            button.disabled = false;
                        }, 1500);
                    }, 1000);
                });
            }
            document.getElementById('previewExcelBtn').addEventListener('click', showExcelPreview);
            document.getElementById('previewExcelBtnMobile').addEventListener('click', showExcelPreview);

            document.getElementById('backupExcelBtn').addEventListener('click', exportBackupExcel);
            document.getElementById('backupExcelBtnMobile').addEventListener('click', exportBackupExcel);
            document.getElementById('importExcelBtn').addEventListener('click', () => document.getElementById('importExcelInput').click());
            document.getElementById('importExcelBtnMobile').addEventListener('click', () => document.getElementById('importExcelInput').click());
            document.getElementById('importExcelInput').addEventListener('change', importBackupExcel);
            document.getElementById('previewPDFBtn').addEventListener('click', showPDFPreview);
            document.getElementById('previewPDFBtnMobile').addEventListener('click', showPDFPreview);
            document.getElementById('exportPDFBtn').addEventListener('click', exportToPDF);
            document.getElementById('exportPDFBtnMobile').addEventListener('click', exportToPDF);
            document.getElementById('clearDataBtn').addEventListener('click', () => document.getElementById('clearDataModal').classList.remove('hidden'));
            document.getElementById('clearDataBtnMobile').addEventListener('click', () => document.getElementById('clearDataModal').classList.remove('hidden'));
            
            // Update progress button
            document.getElementById('updateProgress').addEventListener('click', function() {
                workItems.forEach(item => {
                    updateItemProgress(item.id);
                });
                
                // Force save immediately
                saveProgressData();
                updateLastUpdateTime();
                
                const button = this;
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
                button.className = 'bg-green-600 hover:bg-green-700 text-white px-8 py-3 rounded-lg font-semibold text-lg shadow-lg transform hover:scale-105 transition-all';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = 'w-full sm:w-auto bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-6 sm:px-8 py-3 rounded-lg font-semibold text-base sm:text-lg shadow-lg transform hover:scale-105 transition-all';
                }, 2000);
            });
            
            // Modal close buttons
            document.getElementById('closeLinkModal').addEventListener('click', () => document.getElementById('linkModal').classList.add('hidden'));
            document.getElementById('closeExcelPreview').addEventListener('click', () => document.getElementById('excelPreviewModal').classList.add('hidden'));
            document.getElementById('closeExcelPreviewBtn').addEventListener('click', () => document.getElementById('excelPreviewModal').classList.add('hidden'));
            document.getElementById('closePDFPreview').addEventListener('click', () => document.getElementById('pdfPreviewModal').classList.add('hidden'));
            document.getElementById('closePDFPreviewBtn').addEventListener('click', () => document.getElementById('pdfPreviewModal').classList.add('hidden'));
            document.getElementById('downloadExcelFromPreview').addEventListener('click', downloadExcelWithLocation);
            document.getElementById('downloadPDFFromPreview').addEventListener('click', exportToPDF);
            document.getElementById('cancelClearBtn').addEventListener('click', () => document.getElementById('clearDataModal').classList.add('hidden'));
            
            // Copy link button
            document.getElementById('copyLinkBtn').addEventListener('click', function() {
                const linkInput = document.getElementById('clientLink');
                linkInput.select();
                document.execCommand('copy');
                
                const button = this;
                const originalText = button.innerHTML;
                button.innerHTML = '‚úÖ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!';
                button.className = 'bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-md text-sm';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.className = 'bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-md text-sm';
                }, 3000);
            });
            
            // Company info management
            document.getElementById('logoInput').addEventListener('change', handleLogoUpload);
            document.getElementById('removeLogoBtn').addEventListener('click', removeLogo);
            document.getElementById('saveCompanyInfo').addEventListener('click', saveCompanyInfo);
            
            // Clear data confirmation
            document.getElementById('confirmClearBtn').addEventListener('click', function() {
                const password = document.getElementById('clearPasswordInput').value;
                const correctPassword = 'DELETE123';
                
                if (password === correctPassword) {
                    progressData = {};
                    localStorage.removeItem('constructionProgress');
                    
                    workItems.forEach(item => {
                        for (let week = 1; week <= item.totalWeeks; week++) {
                            const input = document.getElementById(`week_${item.id}_${week}`);
                            if (input) {
                                input.value = 0;
                            }
                        }
                        updateItemProgress(item.id);
                    });
                    
                    updateProgressSummary();
                    updateDashboard();
                    updateLastUpdateTime();
                    
                    document.getElementById('clearDataModal').classList.add('hidden');
                    alert('‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                    
                } else {
                    document.getElementById('passwordError').classList.remove('hidden');
                    document.getElementById('clearPasswordInput').value = '';
                    document.getElementById('clearPasswordInput').focus();
                }
            });
        }

        // Generate work items form
        function generateWorkItems() {
            const container = document.getElementById('workItems');
            container.innerHTML = '';

            workItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'p-4 sm:p-6 bg-white rounded-lg shadow-sm border mb-4 sm:mb-6';
                
                // Create header
                let headerHTML = `
                    <div class="mb-4">
                        <h4 class="text-base sm:text-lg font-semibold text-gray-800 mb-2">${item.id}. ${item.name}</h4>
                        <div class="text-xs sm:text-sm text-gray-600 mb-2">
                            ${item.totalWeeks} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå | ${item.percentPerWeek}% ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå | ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${item.maxPercent}%
                        </div>
                        <div class="bg-blue-50 p-3 rounded-lg">
                            <div class="text-xs sm:text-sm text-blue-800">
                                <strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> 
                                <span id="current_${item.id}" class="font-semibold">0.00%</span>
                                (<span id="weeks_${item.id}">0</span> ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤)
                            </div>
                        </div>
                    </div>
                `;

                // Create week inputs grid
                let weeksHTML = '<div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 xl:grid-cols-10 2xl:grid-cols-12 gap-1 sm:gap-2">';
                
                for (let week = 1; week <= item.totalWeeks; week++) {
                    weeksHTML += `
                        <div class="text-center bg-gray-50 p-1 sm:p-2 rounded-lg border hover:bg-gray-100 transition-colors">
                            <label class="text-xs text-gray-700 block mb-1 font-medium">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå ${week}</label>
                            <input type="number" 
                                   id="week_${item.id}_${week}" 
                                   min="0" 
                                   max="100" 
                                   step="0.01"
                                   placeholder="0"
                                   class="w-full px-1 py-1 sm:px-2 sm:py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-center text-xs sm:text-sm"
                                   onchange="updateItemProgress(${item.id}); autoSaveProgress();"
                                   oninput="updateItemProgress(${item.id}); autoSaveProgress();">
                            <div class="text-xs text-gray-500 mt-1">%</div>
                            <div class="text-xs text-blue-600 mt-1">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${item.percentPerWeek}%</div>
                        </div>
                    `;
                }
                
                weeksHTML += '</div>';

                div.innerHTML = headerHTML + weeksHTML;
                container.appendChild(div);
            });

            // Load saved data after generating inputs
            workItems.forEach(item => {
                for (let week = 1; week <= item.totalWeeks; week++) {
                    const input = document.getElementById(`week_${item.id}_${week}`);
                    if (input && progressData[item.id] && progressData[item.id][week]) {
                        const value = progressData[item.id][week];
                        input.value = value > 0 ? value : '';
                    }
                }
                updateItemProgressDisplay(item.id);
            });
        }

        // Update individual item progress
        function updateItemProgress(itemId) {
            const item = workItems.find(w => w.id === itemId);
            if (!item) return;

            if (!progressData[itemId]) {
                progressData[itemId] = {};
            }

            let totalPercentage = 0;
            let completedWeeks = 0;

            for (let week = 1; week <= item.totalWeeks; week++) {
                const input = document.getElementById(`week_${itemId}_${week}`);
                const percentage = parseFloat(input.value) || 0;
                
                progressData[itemId][week] = percentage;
                totalPercentage += percentage;
                
                if (percentage > 0) completedWeeks++;
            }

            updateItemProgressDisplay(itemId);
            saveProgressData();
            updateProgressSummary();
            updateDashboard();
        }

        // Update item progress display only
        function updateItemProgressDisplay(itemId) {
            const item = workItems.find(w => w.id === itemId);
            if (!item) return;

            let totalPercentage = 0;
            let completedWeeks = 0;

            for (let week = 1; week <= item.totalWeeks; week++) {
                const savedValue = (progressData[itemId] && progressData[itemId][week]) ? progressData[itemId][week] : 0;
                totalPercentage += savedValue;
                if (savedValue > 0) completedWeeks++;
            }

            const currentElement = document.getElementById(`current_${itemId}`);
            const weeksElement = document.getElementById(`weeks_${itemId}`);
            if (currentElement) currentElement.textContent = totalPercentage.toFixed(2) + '%';
            if (weeksElement) weeksElement.textContent = completedWeeks;
        }

        // Update progress summary
        function updateProgressSummary() {
            const container = document.getElementById('progressSummary');
            container.innerHTML = '';
            
            let totalProgress = 0;
            let totalWeeksWithProgress = 0;

            workItems.forEach(item => {
                let itemTotalPercentage = 0;
                let weeksWithProgress = 0;
                
                if (progressData[item.id]) {
                    for (let week = 1; week <= item.totalWeeks; week++) {
                        const weekPercent = parseFloat(progressData[item.id][week]) || 0;
                        itemTotalPercentage += weekPercent;
                        if (weekPercent > 0) weeksWithProgress++;
                    }
                }

                totalProgress += itemTotalPercentage;
                totalWeeksWithProgress += weeksWithProgress;

                let status = '';
                let statusColor = '';
                const completionRate = (itemTotalPercentage / item.maxPercent) * 100;
                
                // ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö updateDashboard
                const roundedTotal = Math.round(itemTotalPercentage * 100) / 100;
                const roundedMax = Math.round(item.maxPercent * 100) / 100;
                
                if (roundedTotal === 0) {
                    status = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° (0%)';
                    statusColor = 'text-gray-500';
                } else if (roundedTotal >= roundedMax) {
                    status = `‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (100%)`;
                    statusColor = 'text-green-500';
                } else {
                    status = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (${completionRate.toFixed(1)}%)`;
                    statusColor = 'text-blue-500';
                }

                const div = document.createElement('div');
                div.className = 'flex justify-between items-center p-3 bg-white rounded-lg shadow-sm border-l-4 ' + 
                    (roundedTotal >= roundedMax ? 'border-green-400' : roundedTotal > 0 ? 'border-orange-400' : 'border-gray-300');
                div.innerHTML = `
                    <div class="flex-1">
                        <span class="text-sm text-gray-700">${item.id}. ${item.name.substring(0, 35)}...</span>
                        <div class="text-xs ${statusColor} mt-1">${status}</div>
                        <div class="text-xs text-gray-400">${weeksWithProgress} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-semibold text-blue-600">${itemTotalPercentage.toFixed(2)}%/${item.maxPercent}%</div>
                        <div class="text-xs text-purple-600">${completionRate.toFixed(1)}% ‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô</div>
                    </div>
                `;
                container.appendChild(div);
            });

            document.getElementById('totalProgress').textContent = totalProgress.toFixed(2) + '%';
            document.getElementById('totalDays').textContent = totalWeeksWithProgress + ' ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå';
        }

        // Update dashboard
        function updateDashboard() {
            let totalProgress = 0;
            let completedTasks = 0;
            let inProgressTasks = 0;
            let notStartedTasks = 0;
            
            console.log('=== ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì ===');
            
            workItems.forEach(item => {
                let itemTotalPercentage = 0;
                
                if (progressData[item.id]) {
                    for (let week = 1; week <= item.totalWeeks; week++) {
                        const weekPercent = parseFloat(progressData[item.id][week]) || 0;
                        itemTotalPercentage += weekPercent;
                    }
                }

                totalProgress += itemTotalPercentage;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î
                console.log(`‡∏´‡∏°‡∏ß‡∏î ${item.id}: ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°=${itemTotalPercentage.toFixed(2)}%, ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢=${item.maxPercent}%`);
                
                // ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô (‡πÉ‡∏ä‡πâ‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏° 2 ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö):
                const roundedTotal = Math.round(itemTotalPercentage * 100) / 100;
                const roundedMax = Math.round(item.maxPercent * 100) / 100;
                
                if (roundedTotal >= roundedMax) {
                    completedTasks++;
                    console.log(`  -> ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (${roundedTotal} >= ${roundedMax})`);
                } else if (roundedTotal > 0) {
                    inProgressTasks++;
                    console.log(`  -> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (${roundedTotal} > 0 ‡πÅ‡∏ï‡πà < ${roundedMax})`);
                } else {
                    notStartedTasks++;
                    console.log(`  -> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° (${roundedTotal} = 0)`);
                }
            });

            console.log(`‡∏™‡∏£‡∏∏‡∏õ: ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß=${completedTasks}, ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£=${inProgressTasks}, ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°=${notStartedTasks}`);
            console.log('=== ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ===');

            // Update progress with animation
            document.getElementById('dashTotalProgress').textContent = totalProgress.toFixed(2) + '%';
            document.getElementById('completedTasks').textContent = completedTasks;
            document.getElementById('inProgressTasks').textContent = inProgressTasks;
            
            // Update progress bar with animation
            const progressBar = document.getElementById('totalProgressBar');
            if (progressBar) {
                // Calculate total possible progress (sum of all maxPercent)
                const totalPossible = workItems.reduce((sum, item) => sum + item.maxPercent, 0);
                const progressPercentage = Math.min((totalProgress / totalPossible) * 100, 100);
                
                setTimeout(() => {
                    progressBar.style.width = progressPercentage + '%';
                }, 100);
            }

            updateDetailedProgress();
            updateAllCharts();
        }

        // Update detailed progress
        function updateDetailedProgress() {
            const container = document.getElementById('detailedProgress');
            container.innerHTML = '';

            workItems.forEach(item => {
                let itemTotalPercentage = 0;
                let weeksWithProgress = 0;
                
                if (progressData[item.id]) {
                    for (let week = 1; week <= item.totalWeeks; week++) {
                        const weekPercent = parseFloat(progressData[item.id][week]) || 0;
                        itemTotalPercentage += weekPercent;
                        if (weekPercent > 0) weeksWithProgress++;
                    }
                }

                const progressWidth = Math.min((itemTotalPercentage / item.maxPercent) * 100, 100);
                const completionRate = (itemTotalPercentage / item.maxPercent) * 100;

                let status = '';
                let statusColor = '';
                let statusIcon = '';
                
                // ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö updateDashboard
                const roundedTotal = Math.round(itemTotalPercentage * 100) / 100;
                const roundedMax = Math.round(item.maxPercent * 100) / 100;
                
                if (roundedTotal === 0) {
                    status = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° (0%)';
                    statusColor = 'text-gray-500';
                    statusIcon = '‚è∏Ô∏è';
                } else if (roundedTotal >= roundedMax) {
                    status = `‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (100%)`;
                    statusColor = 'text-green-600';
                    statusIcon = '‚úÖ';
                } else {
                    status = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (${completionRate.toFixed(1)}%)`;
                    statusColor = 'text-blue-600';
                    statusIcon = 'üîÑ';
                }

                const div = document.createElement('div');
                div.className = 'p-3 bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow cursor-pointer';
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex-1 pr-3">
                            <h4 class="text-sm font-semibold text-gray-800 mb-1">${item.id}. ${item.name}</h4>
                            <p class="text-xs text-gray-600 leading-relaxed">${item.fullName}</p>
                        </div>
                        <div class="text-right flex-shrink-0">
                            <span class="text-sm font-bold ${roundedTotal >= roundedMax ? 'text-green-600' : 'text-blue-600'}">${itemTotalPercentage.toFixed(2)}%</span>
                            <div class="text-xs ${statusColor} flex items-center justify-end mt-1">
                                <span class="mr-1">${statusIcon}</span>
                                ${status}
                            </div>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-2">
                        <div class="h-2 rounded-full ${roundedTotal >= roundedMax ? 'bg-green-500' : 'bg-blue-500'} transition-all duration-500" style="width: ${progressWidth}%"></div>
                    </div>
                    <div class="flex justify-between items-center text-xs text-gray-500">
                        <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤: ${completionRate.toFixed(1)}%</span>
                        <span>${weeksWithProgress} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        // Update all charts
        function updateAllCharts() {
            updateOverallChart();
            updateIndividualCharts();
        }

        // Update overall pie chart
        function updateOverallChart() {
            if (overallChart) {
                overallChart.destroy();
            }

            const ctx = document.getElementById('overallChart');
            if (!ctx) return;

            const colors = [
                'rgba(239, 68, 68, 0.9)',
                'rgba(245, 158, 11, 0.9)',
                'rgba(34, 197, 94, 0.9)',
                'rgba(59, 130, 246, 0.9)',
                'rgba(147, 51, 234, 0.9)',
                'rgba(236, 72, 153, 0.9)',
                'rgba(14, 165, 233, 0.9)'
            ];

            let chartData = [];
            let chartLabels = [];
            let chartColors = [];
            let legendContainer = document.getElementById('chartLegend');
            legendContainer.innerHTML = '';

            workItems.forEach((item, index) => {
                let itemTotalPercentage = 0;
                let weeksWithProgress = 0;
                
                if (progressData[item.id]) {
                    for (let week = 1; week <= item.totalWeeks; week++) {
                        const weekPercent = parseFloat(progressData[item.id][week]) || 0;
                        itemTotalPercentage += weekPercent;
                        if (weekPercent > 0) weeksWithProgress++;
                    }
                }

                const percentage = parseFloat(itemTotalPercentage.toFixed(2));
                
                if (percentage > 0) {
                    chartData.push(percentage);
                    chartLabels.push(`‡∏´‡∏°‡∏ß‡∏î ${item.id}`);
                    chartColors.push(colors[index]);

                    const legendItem = document.createElement('div');
                    legendItem.className = 'flex items-center p-2 bg-white rounded-lg shadow-sm border';
                    legendItem.innerHTML = `
                        <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${colors[index]}"></div>
                        <div class="flex-1">
                            <div class="text-xs font-medium text-gray-800">‡∏´‡∏°‡∏ß‡∏î ${item.id}</div>
                            <div class="text-xs text-gray-600">${item.name.substring(0, 20)}...</div>
                            <div class="text-xs font-bold text-blue-600">${percentage}%</div>
                        </div>
                    `;
                    legendContainer.appendChild(legendItem);
                }
            });

            if (chartData.length === 0) {
                chartData = [1];
                chartLabels = ['‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'];
                chartColors = ['rgba(229, 231, 235, 0.5)'];
                
                legendContainer.innerHTML = `
                    <div class="flex items-center justify-center p-4 bg-gray-50 rounded-lg">
                        <div class="text-gray-500 text-center">
                            <div class="text-2xl mb-2">üìä</div>
                            <div class="text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</div>
                        </div>
                    </div>
                `;
            }

            overallChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: chartLabels,
                    datasets: [{
                        data: chartData,
                        backgroundColor: chartColors,
                        borderColor: '#ffffff',
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Update individual pie charts
        function updateIndividualCharts() {
            individualCharts.forEach(chart => {
                if (chart) chart.destroy();
            });
            individualCharts = [];

            const container = document.getElementById('individualCharts');
            container.innerHTML = '';

            const colors = [
                'rgba(239, 68, 68, 0.9)',
                'rgba(245, 158, 11, 0.9)',
                'rgba(34, 197, 94, 0.9)',
                'rgba(59, 130, 246, 0.9)',
                'rgba(147, 51, 234, 0.9)',
                'rgba(236, 72, 153, 0.9)',
                'rgba(14, 165, 233, 0.9)'
            ];

            workItems.forEach((item, index) => {
                let itemTotalPercentage = 0;
                let weeksWithProgress = 0;
                
                if (progressData[item.id]) {
                    for (let week = 1; week <= item.totalWeeks; week++) {
                        const weekPercent = parseFloat(progressData[item.id][week]) || 0;
                        itemTotalPercentage += weekPercent;
                        if (weekPercent > 0) weeksWithProgress++;
                    }
                }

                const percentage = parseFloat(itemTotalPercentage.toFixed(2));
                const remaining = parseFloat((item.maxPercent - percentage).toFixed(2));

                const chartDiv = document.createElement('div');
                chartDiv.className = 'bg-white p-3 rounded-xl shadow-lg border-2 transition-all duration-300 hover:shadow-xl hover:-translate-y-1';
                
                let statusColor = '';
                let statusText = '';
                let borderColor = '';
                let bgGradient = '';
                let iconEmoji = '';
                const completionRate = (itemTotalPercentage / item.maxPercent) * 100;
                
                // ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏∑‡πà‡∏ô‡πÜ
                const roundedTotal = Math.round(itemTotalPercentage * 100) / 100;
                const roundedMax = Math.round(item.maxPercent * 100) / 100;
                
                if (roundedTotal === 0) {
                    statusColor = 'text-gray-600';
                    statusText = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°';
                    borderColor = 'border-gray-300';
                    bgGradient = 'bg-gradient-to-br from-gray-50 to-gray-100';
                    iconEmoji = '‚è∏Ô∏è';
                } else if (roundedTotal >= roundedMax) {
                    statusColor = 'text-emerald-600';
                    if (roundedTotal > roundedMax) {
                        statusText = `‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô (‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢)`;
                    } else {
                        statusText = `‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô`;
                    }
                    borderColor = 'border-emerald-300';
                    bgGradient = 'bg-gradient-to-br from-emerald-50 to-green-100';
                    iconEmoji = '‚úÖ';
                } else {
                    statusColor = 'text-blue-600';
                    statusText = `‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£`;
                    borderColor = 'border-blue-300';
                    bgGradient = 'bg-gradient-to-br from-blue-50 to-indigo-100';
                    iconEmoji = 'üîÑ';
                }

                chartDiv.className += ` ${borderColor} ${bgGradient}`;
                
                chartDiv.innerHTML = `
                    <div class="text-center mb-2">
                        <div class="inline-flex items-center justify-center w-8 h-8 bg-white rounded-full shadow-md mb-2">
                            <span class="text-sm">${iconEmoji}</span>
                        </div>
                        <h4 class="font-semibold text-gray-800 text-sm mb-1">‡∏´‡∏°‡∏ß‡∏î ${item.id}</h4>
                        <div class="text-lg font-bold ${statusColor}">${completionRate.toFixed(1)}%</div>
                        <div class="text-xs ${statusColor} font-medium">${statusText}</div>
                    </div>
                    <div class="flex justify-center mb-2">
                        <div class="relative">
                            <canvas id="chart_${item.id}" width="90" height="90"></canvas>
                            <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <div class="text-xs font-bold ${statusColor}">${Math.round(completionRate)}%</div>
                            </div>
                        </div>
                    </div>
                    <div class="text-xs text-gray-500 text-center">
                        ${percentage.toFixed(1)}% / ${item.maxPercent}%
                    </div>
                `;
                
                container.appendChild(chartDiv);

                const ctx = document.getElementById(`chart_${item.id}`).getContext('2d');
                
                const chart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß', '‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠'],
                        datasets: [{
                            data: [percentage, Math.max(0, remaining)],
                            backgroundColor: [
                                colors[index],
                                'rgba(229, 231, 235, 0.5)'
                            ],
                            borderColor: '#ffffff',
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        cutout: '60%',
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });

                individualCharts.push(chart);
            });
        }

        // Generate shareable link
        function generateShareableLink() {
            try {
                // Create real-time URL (no data encoding needed)
                const currentUrl = window.location.href.split('?')[0].split('#')[0];
                const shareableUrl = `${currentUrl}?view=client`;
                
                document.getElementById('clientLink').value = shareableUrl;
                document.getElementById('linkModal').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error generating link:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Ñ‡πå');
            }
        }

        // Show client dashboard only
        function showClientDashboard() {
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.querySelector('nav').style.display = 'none';
            
            // Load data from localStorage (real-time)
            loadProgressData();
            loadCompanyData();
            updateCompanyDisplay();
            updateDashboard();
            
            // Set up real-time updates every 5 seconds
            setInterval(() => {
                loadProgressData();
                loadCompanyData();
                updateCompanyDisplay();
                updateDashboard();
                updateLastUpdateTime();
                console.log('üîÑ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤');
            }, 5000);
            
            // Add client view indicator
            const indicator = document.createElement('div');
            indicator.className = 'fixed top-4 left-4 bg-green-500 text-white px-3 py-1 rounded-lg shadow-lg z-50 text-sm animate-pulse';
            indicator.innerHTML = 'üî¥ LIVE - ‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)';
            document.body.appendChild(indicator);
        }

        // Show Excel Preview
        function showExcelPreview() {
            try {
                const previewContent = document.getElementById('excelPreviewContent');
                
                let htmlContent = `
                    <div class="bg-white border border-gray-300 rounded-lg overflow-hidden">
                        <div class="bg-green-600 text-white p-3 text-center font-bold">
                            üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á
                        </div>
                        <div class="p-4">
                            <div class="mb-4 text-sm text-gray-600">
                                <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô:</strong> ${new Date().toLocaleString('th-TH')}
                            </div>
                            
                            <table class="w-full border-collapse border border-gray-300 text-sm">
                                <thead>
                                    <tr class="bg-blue-50">
                                        <th class="border border-gray-300 p-2 text-left">‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</th>
                                        <th class="border border-gray-300 p-2 text-left">‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô</th>
                                        <th class="border border-gray-300 p-2 text-center">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏° (%)</th>
                                        <th class="border border-gray-300 p-2 text-center">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (%)</th>
                                        <th class="border border-gray-300 p-2 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        <th class="border border-gray-300 p-2 text-center">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (%)</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                let totalProjectProgress = 0;
                let completedTasks = 0;

                workItems.forEach(item => {
                    let itemTotalPercentage = 0;
                    
                    if (progressData[item.id]) {
                        for (let week = 1; week <= item.totalWeeks; week++) {
                            const weekPercent = progressData[item.id][week] || 0;
                            itemTotalPercentage += weekPercent;
                        }
                    }

                    totalProjectProgress += itemTotalPercentage;
                    const completionRate = (itemTotalPercentage / item.maxPercent) * 100;
                    let status = '';
                    let statusColor = '';
                    
                    if (itemTotalPercentage === 0) {
                        status = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°';
                        statusColor = 'text-gray-500';
                    } else if (itemTotalPercentage >= item.maxPercent) {
                        status = '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
                        statusColor = 'text-green-600';
                        completedTasks++;
                    } else {
                        status = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
                        statusColor = 'text-blue-600';
                    }

                    htmlContent += `
                        <tr class="hover:bg-gray-50">
                            <td class="border border-gray-300 p-2">‡∏´‡∏°‡∏ß‡∏î ${item.id}</td>
                            <td class="border border-gray-300 p-2">${item.name}</td>
                            <td class="border border-gray-300 p-2 text-center font-semibold">${itemTotalPercentage.toFixed(2)}</td>
                            <td class="border border-gray-300 p-2 text-center">${item.maxPercent.toFixed(2)}</td>
                            <td class="border border-gray-300 p-2 text-center ${statusColor}">${status}</td>
                            <td class="border border-gray-300 p-2 text-center font-semibold">${completionRate.toFixed(1)}</td>
                        </tr>
                    `;
                });

                htmlContent += `
                                </tbody>
                            </table>
                            
                            <div class="mt-6 bg-blue-50 p-4 rounded-lg">
                                <h4 class="font-bold text-blue-800 mb-2">üìà ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div class="bg-white p-3 rounded border">
                                        <div class="text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:</div>
                                        <div class="text-2xl font-bold text-blue-600">${totalProjectProgress.toFixed(2)}%</div>
                                    </div>
                                    <div class="bg-white p-3 rounded border">
                                        <div class="text-gray-600">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô:</div>
                                        <div class="text-2xl font-bold text-green-600">${completedTasks} ‡∏à‡∏≤‡∏Å 7 ‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                previewContent.innerHTML = htmlContent;
                document.getElementById('excelPreviewModal').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error showing Excel preview:', error);
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á Excel');
            }
        }

        // Show PDF Preview
        function showPDFPreview() {
            try {
                const previewContent = document.getElementById('pdfPreviewContent');
                
                // Clone admin panel for preview
                const adminClone = document.getElementById('adminPanel').cloneNode(true);
                adminClone.id = 'adminPreview';
                adminClone.className = 'bg-white p-4 rounded-lg border shadow-sm';
                
                // Clone dashboard for preview
                const dashboardClone = document.getElementById('dashboard').cloneNode(true);
                dashboardClone.id = 'dashboardPreview';
                dashboardClone.className = 'bg-white p-4 rounded-lg border shadow-sm';
                dashboardClone.classList.remove('hidden');
                
                previewContent.innerHTML = `
                    <div class="space-y-6">
                        <div class="text-center bg-blue-600 text-white p-4 rounded-lg">
                            <h2 class="text-xl font-bold">üìÑ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ PDF</h2>
                            <p class="text-sm mt-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á: ${new Date().toLocaleString('th-TH')}</p>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-3 text-gray-800">üìã ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 1: ‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                            <div class="bg-white p-3 rounded border text-sm text-gray-600">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <strong>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏ß‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ:</strong>
                                        <ul class="list-disc list-inside mt-2 space-y-1">
                                            <li>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ 7 ‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</li>
                                            <li>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î</li>
                                            <li>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£: <span class="font-bold text-blue-600">${calculateTotalProgress().toFixed(2)}%</span></li>
                                        </ul>
                                    </div>
                                    <div>
                                        <strong>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô:</strong>
                                        <div class="mt-2 space-y-1 text-xs">
                `;
                
                workItems.forEach(item => {
                    let itemTotal = 0;
                    if (progressData[item.id]) {
                        for (let week = 1; week <= item.totalWeeks; week++) {
                            itemTotal += progressData[item.id][week] || 0;
                        }
                    }
                    previewContent.innerHTML += `
                        <div class="flex justify-between">
                            <span>‡∏´‡∏°‡∏ß‡∏î ${item.id}:</span>
                            <span class="font-semibold">${itemTotal.toFixed(2)}%</span>
                        </div>
                    `;
                });
                
                previewContent.innerHTML += `
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="text-lg font-semibold mb-3 text-gray-800">üìä ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà 2: ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</h3>
                            <div class="bg-white p-3 rounded border text-sm text-gray-600">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <strong>‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏£‡∏ß‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ:</strong>
                                        <ul class="list-disc list-inside mt-2 space-y-1">
                                            <li>‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏£‡∏ß‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô</li>
                                            <li>‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô (7 ‡∏Å‡∏£‡∏≤‡∏ü)</li>
                                            <li>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</li>
                                            <li>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <strong>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong>
                                        <div class="mt-2 space-y-2">
                                            <div class="bg-blue-50 p-2 rounded">
                                                <div class="text-xs text-blue-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°</div>
                                                <div class="text-lg font-bold text-blue-800">${calculateTotalProgress().toFixed(2)}%</div>
                                            </div>
                                            <div class="bg-green-50 p-2 rounded">
                                                <div class="text-xs text-green-600">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
                                                <div class="text-lg font-bold text-green-800">${calculateCompletedTasks()} ‡∏´‡∏°‡∏ß‡∏î</div>
                                            </div>
                                            <div class="bg-orange-50 p-2 rounded">
                                                <div class="text-xs text-orange-600">‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
                                                <div class="text-lg font-bold text-orange-800">${calculateInProgressTasks()} ‡∏´‡∏°‡∏ß‡∏î</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400">
                            <div class="flex items-start">
                                <div class="text-yellow-600 mr-3 text-xl">üí°</div>
                                <div>
                                    <h4 class="font-semibold text-yellow-800">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</h4>
                                    <p class="text-sm text-yellow-700 mt-1">
                                        ‡πÑ‡∏ü‡∏•‡πå PDF ‡∏à‡∏∞‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ 2 ‡∏´‡∏ô‡πâ‡∏≤ ‡πÇ‡∏î‡∏¢‡∏à‡∏∞‡∏à‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏£‡∏¥‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('pdfPreviewModal').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error showing PDF preview:', error);
                alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á PDF');
            }
        }

        // Helper functions for PDF preview
        function calculateTotalProgress() {
            let total = 0;
            workItems.forEach(item => {
                if (progressData[item.id]) {
                    for (let week = 1; week <= item.totalWeeks; week++) {
                        total += progressData[item.id][week] || 0;
                    }
                }
            });
            return total;
        }

        function calculateCompletedTasks() {
            let completed = 0;
            workItems.forEach(item => {
                let itemTotal = 0;
                if (progressData[item.id]) {
                    for (let week = 1; week <= item.totalWeeks; week++) {
                        itemTotal += progressData[item.id][week] || 0;
                    }
                }
                // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏≠‡∏î‡πÄ‡∏Å‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ = ‡∏á‡∏≤‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô
                if (itemTotal >= item.maxPercent) completed++;
            });
            return completed;
        }

        function calculateInProgressTasks() {
            let inProgress = 0;
            workItems.forEach(item => {
                let itemTotal = 0;
                if (progressData[item.id]) {
                    for (let week = 1; week <= item.totalWeeks; week++) {
                        itemTotal += progressData[item.id][week] || 0;
                    }
                }
                // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏≠‡∏î‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0 ‡πÅ‡∏ï‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ = ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
                if (itemTotal > 0 && itemTotal < item.maxPercent) inProgress++;
            });
            return inProgress;
        }

        // Export backup Excel (editable format)
        function exportBackupExcel() {
            if (typeof XLSX === 'undefined') {
                alert('‚ùå ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ Excel ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                return;
            }
            
            try {
                console.log('üîÑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á Excel...');
                
                // Show loading state
                const button = document.getElementById('backupExcelBtn') || document.getElementById('backupExcelBtnMobile');
                if (button) {
                    const originalText = button.innerHTML;
                    button.innerHTML = 'üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á...';
                    button.disabled = true;
                    
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.disabled = false;
                    }, 5000);
                }
                
                const wb = XLSX.utils.book_new();
                
                // Create backup data sheet
                const backupData = [
                    ['‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á'],
                    ['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏£‡∏≠‡∏á:', new Date().toLocaleString('th-TH')],
                    [''],
                    ['‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (%)" ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö'],
                    [''],
                    ['‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô', '‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô', '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (%)', '‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (%)']
                ];
                
                workItems.forEach(item => {
                    for (let week = 1; week <= item.totalWeeks; week++) {
                        const currentProgress = (progressData[item.id] && progressData[item.id][week]) ? progressData[item.id][week] : 0;
                        backupData.push([
                            `‡∏´‡∏°‡∏ß‡∏î ${item.id}`, 
                            item.name, 
                            week, 
                            currentProgress, 
                            item.percentPerWeek
                        ]);
                    }
                });
                
                console.log('üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å:', backupData.length, '‡πÅ‡∏ñ‡∏ß');
                
                const ws1 = XLSX.utils.aoa_to_sheet(backupData);
                ws1['!cols'] = [
                    { wch: 15 }, // ‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô
                    { wch: 50 }, // ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô
                    { wch: 12 }, // ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà
                    { wch: 18 }, // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤ (%)
                    { wch: 25 }  // ‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (%)
                ];
                XLSX.utils.book_append_sheet(wb, ws1, '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á');
                
                // Create summary sheet
                const summaryData = [
                    ['‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ (‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)'],
                    ['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á:', new Date().toLocaleString('th-TH')],
                    [''],
                    ['‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô', '‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏° (%)', '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (%)', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (%)']
                ];
                
                let totalProjectProgress = 0;
                let completedTasks = 0;
                
                workItems.forEach(item => {
                    let itemTotalPercentage = 0;
                    
                    if (progressData[item.id]) {
                        for (let week = 1; week <= item.totalWeeks; week++) {
                            itemTotalPercentage += progressData[item.id][week] || 0;
                        }
                    }
                    
                    totalProjectProgress += itemTotalPercentage;
                    const completionRate = (itemTotalPercentage / item.maxPercent) * 100;
                    
                    let status = '';
                    if (itemTotalPercentage === 0) {
                        status = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°';
                    } else if (itemTotalPercentage >= item.maxPercent) {
                        status = '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô';
                        completedTasks++;
                    } else {
                        status = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£';
                    }
                    
                    summaryData.push([
                        `‡∏´‡∏°‡∏ß‡∏î ${item.id}`, 
                        item.name, 
                        itemTotalPercentage.toFixed(2), 
                        item.maxPercent.toFixed(2), 
                        status, 
                        completionRate.toFixed(1)
                    ]);
                });
                
                summaryData.push(['']);
                summaryData.push(['‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£']);
                summaryData.push(['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:', `${totalProjectProgress.toFixed(2)}%`]);
                summaryData.push(['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô:', `${completedTasks} ‡∏à‡∏≤‡∏Å ${workItems.length} ‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô`]);
                
                const ws2 = XLSX.utils.aoa_to_sheet(summaryData);
                ws2['!cols'] = [
                    { wch: 15 }, // ‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô
                    { wch: 50 }, // ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô
                    { wch: 20 }, // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏° (%)
                    { wch: 15 }, // ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (%)
                    { wch: 20 }, // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                    { wch: 20 }  // ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (%)
                ];
                XLSX.utils.book_append_sheet(wb, ws2, '‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£');
                
                // Generate filename
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const filename = `‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£_${year}-${month}-${day}_${hours}-${minutes}.xlsx`;
                
                console.log('üíæ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå:', filename);
                
                // Try multiple download methods
                try {
                    // Method 1: Standard download
                    const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
                    const blob = new Blob([wbout], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                    
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                    
                    console.log('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1)');
                    
                } catch (downloadError) {
                    console.log('‚ö†Ô∏è ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1 ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß, ‡∏•‡∏≠‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2...');
                    
                    // Method 2: Alternative download
                    XLSX.writeFile(wb, filename);
                    console.log('‚úÖ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 2)');
                }
                
                alert(`‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß!\n\nüìÅ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${filename}\nüìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${workItems.length} ‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleString('th-TH')}\nüíæ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå Downloads\n\nüí° ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ`);
                
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á:', error);
                
                let errorMessage = '‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏£‡∏≠‡∏á\n\n';
                
                if (error.message.includes('XLSX')) {
                    errorMessage += '‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ Excel ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô\n‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
                } else if (error.message.includes('download')) {
                    errorMessage += '‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î\n‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå';
                } else {
                    errorMessage += `‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${error.message}\n\n‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:\n- ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö\n- ‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô\n- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á`;
                }
                
                alert(errorMessage);
            }
        }

        // Import backup Excel
        function importBackupExcel(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (typeof XLSX === 'undefined') {
                alert('‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ Excel ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    console.log('Available sheets:', workbook.SheetNames);
                    
                    // Look for the backup data sheet
                    const sheetName = workbook.SheetNames.find(name => 
                        name.includes('‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏£‡∏≠‡∏á') || name.includes('backup') || name.includes('data')
                    ) || workbook.SheetNames[0];
                    
                    console.log('Using sheet:', sheetName);
                    
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                    
                    console.log('Raw data:', jsonData);
                    
                    // Find the header row
                    let headerRowIndex = -1;
                    for (let i = 0; i < jsonData.length; i++) {
                        if (jsonData[i] && jsonData[i].some(cell => 
                            typeof cell === 'string' && (cell.includes('‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô') || cell.includes('‡∏´‡∏°‡∏ß‡∏î'))
                        )) {
                            headerRowIndex = i;
                            console.log('Found header at row:', i, jsonData[i]);
                            break;
                        }
                    }
                    
                    if (headerRowIndex === -1) {
                        alert('‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå Excel\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                        return;
                    }
                    
                    // Clear existing data first
                    const oldProgressData = { ...progressData };
                    progressData = {};
                    
                    // Initialize all categories
                    workItems.forEach(item => {
                        progressData[item.id] = {};
                        for (let week = 1; week <= item.totalWeeks; week++) {
                            progressData[item.id][week] = 0;
                        }
                    });
                    
                    // Import data
                    let importedCount = 0;
                    let debugInfo = [];
                    
                    for (let i = headerRowIndex + 1; i < jsonData.length; i++) {
                        const row = jsonData[i];
                        if (!row || row.length < 4) continue;
                        
                        const categoryText = row[0];
                        const taskName = row[1];
                        const week = parseInt(row[2]);
                        const percentage = parseFloat(row[3]) || 0;
                        
                        console.log(`Processing row ${i}:`, { categoryText, taskName, week, percentage });
                        
                        // Extract category ID - more flexible matching
                        let categoryId = null;
                        if (categoryText) {
                            const categoryMatch = categoryText.toString().match(/‡∏´‡∏°‡∏ß‡∏î\s*(\d+)/);
                            if (categoryMatch) {
                                categoryId = parseInt(categoryMatch[1]);
                            } else {
                                // Try to match just the number if it's a simple format
                                const numberMatch = categoryText.toString().match(/(\d+)/);
                                if (numberMatch) {
                                    categoryId = parseInt(numberMatch[1]);
                                }
                            }
                        }
                        
                        if (!categoryId) {
                            console.log('Could not extract category ID from:', categoryText);
                            continue;
                        }
                        
                        const item = workItems.find(w => w.id === categoryId);
                        if (!item) {
                            console.log('Item not found for category:', categoryId);
                            continue;
                        }
                        
                        if (week < 1 || week > item.totalWeeks) {
                            console.log('Week out of range:', week, 'for item:', item.name);
                            continue;
                        }
                        
                        // Validate percentage - allow up to 100% but warn if over limit
                        const maxAllowed = item.percentPerWeek;
                        let validPercentage = Math.max(0, Math.min(percentage, 100));
                        
                        if (percentage > maxAllowed) {
                            console.log(`Warning: Week ${week} of category ${categoryId} has ${percentage}% (max recommended: ${maxAllowed}%)`);
                        }
                        
                        progressData[categoryId][week] = validPercentage;
                        importedCount++;
                        
                        debugInfo.push({
                            category: categoryId,
                            week: week,
                            value: validPercentage,
                            original: percentage
                        });
                    }
                    
                    console.log('Import debug info:', debugInfo);
                    console.log('Final progressData:', progressData);
                    
                    // Update all UI inputs
                    workItems.forEach(item => {
                        for (let week = 1; week <= item.totalWeeks; week++) {
                            const input = document.getElementById(`week_${item.id}_${week}`);
                            if (input) {
                                const value = progressData[item.id][week] || 0;
                                input.value = value > 0 ? value : '';
                                console.log(`Set input week_${item.id}_${week} to ${value}`);
                            }
                        }
                    });
                    
                    // Force update all displays
                    workItems.forEach(item => {
                        updateItemProgressDisplay(item.id);
                    });
                    
                    // Save and update everything
                    saveProgressData();
                    updateProgressSummary();
                    updateDashboard();
                    updateLastUpdateTime();
                    
                    // Show detailed success message
                    let successMessage = `‚úÖ ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\nüìä ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ${importedCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\nüìÖ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}\n\n`;
                    
                    // Add summary by category
                    workItems.forEach(item => {
                        let itemTotal = 0;
                        let itemWeeks = 0;
                        for (let week = 1; week <= item.totalWeeks; week++) {
                            const value = progressData[item.id][week] || 0;
                            itemTotal += value;
                            if (value > 0) itemWeeks++;
                        }
                        if (itemWeeks > 0) {
                            successMessage += `‡∏´‡∏°‡∏ß‡∏î ${item.id}: ${itemTotal.toFixed(2)}% (${itemWeeks} ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå)\n`;
                        }
                    });
                    
                    alert(successMessage);
                    
                } catch (error) {
                    console.error('Error importing Excel:', error);
                    alert('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå Excel\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ' + error.message + '\n\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\n- ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö .xlsx ‡∏´‡∏£‡∏∑‡∏≠ .xls\n- ‡πÑ‡∏ü‡∏•‡πå‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ\n- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á');
                }
            };
            
            reader.readAsArrayBuffer(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Download Excel with location choice
        function downloadExcelWithLocation() {
            if (typeof XLSX === 'undefined') return alert('XLSX ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            
            try {
                const aoa = [
                    ['‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á'],
                    ['‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô:', new Date().toLocaleString('th-TH')],
                    [''],
                    ['‡∏™‡∏£‡∏∏‡∏õ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£'],
                    ['‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô', '‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏° (%)', '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (%)', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞', '‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (%)']
                ];
                
                let sum = 0, done = 0;
                workItems.forEach(it => {
                    let total = 0;
                    if (progressData[it.id]) {
                        for (let week = 1; week <= it.totalWeeks; week++) {
                            total += progressData[it.id][week] || 0;
                        }
                    }
                    sum += total;
                    const completion = (total / it.maxPercent) * 100;
                    let status = total === 0 ? '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°' : (total >= it.maxPercent ? '‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£');
                    if (total >= it.maxPercent) done++;
                    aoa.push([`‡∏´‡∏°‡∏ß‡∏î ${it.id}`, it.name, total.toFixed(2), it.maxPercent.toFixed(2), status, completion.toFixed(1)]);
                });
                
                aoa.push(['']);
                aoa.push(['‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£']);
                aoa.push(['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£:', `${sum.toFixed(2)}%`]);
                aoa.push(['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô:', `${done} ‡∏à‡∏≤‡∏Å ${workItems.length} ‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô`]);
                
                const ws = XLSX.utils.aoa_to_sheet(aoa);
                ws['!cols'] = [{ wch: 15 }, { wch: 50 }, { wch: 18 }, { wch: 15 }, { wch: 20 }, { wch: 18 }];
                
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£');
                
                const now = new Date();
                const filename = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£_${now.getFullYear()}-${(now.getMonth() + 1 + '').padStart(2, '0')}-${(now.getDate() + '').padStart(2, '0')}_${(now.getHours() + '').padStart(2, '0')}-${(now.getMinutes() + '').padStart(2, '0')}.xlsx`;
                
                // Create download with save dialog
                const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
                const blob = new Blob([wbout], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
                
                // Create download link with download attribute to trigger save dialog
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                alert(`‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel ‡πÅ‡∏•‡πâ‡∏ß!\n\nüìÅ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${filename}\nüíæ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î`);
                
            } catch (e) {
                console.error(e);
                alert('‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á Excel ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' + e.message);
            }
        }

        // Export to PDF
        async function exportToPDF() {
            // Check if required libraries are loaded
            if (typeof window.jspdf === 'undefined' || typeof html2canvas === 'undefined') {
                alert('‚ùå ‡πÑ‡∏•‡∏ö‡∏£‡∏≤‡∏£‡∏µ PDF ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà');
                return;
            }

            try {
                // Show loading message
                const loadingAlert = alert('üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF...\n‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà');
                
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('p', 'mm', 'a4');
                
                // Remove first blank page
                pdf.deletePage(1);
                
                // Capture Admin Panel
                const adminPanel = document.getElementById('adminPanel');
                if (!adminPanel) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô');
                }
                
                // Ensure admin panel is visible for capture
                const adminWasHidden = adminPanel.classList.contains('hidden');
                if (adminWasHidden) {
                    adminPanel.classList.remove('hidden');
                }
                
                const adminCanvas = await html2canvas(adminPanel, {
                    scale: 0.8,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: adminPanel.scrollWidth,
                    height: adminPanel.scrollHeight,
                    scrollX: 0,
                    scrollY: 0
                });
                
                // Restore admin panel visibility
                if (adminWasHidden) {
                    adminPanel.classList.add('hidden');
                }
                
                const adminImgData = adminCanvas.toDataURL('image/png', 0.8);
                const adminImgWidth = 190;
                const adminImgHeight = (adminCanvas.height * adminImgWidth) / adminCanvas.width;
                
                // Add first page - Admin Panel
                pdf.addPage();
                pdf.setFontSize(18);
                pdf.setFont('helvetica', 'bold');
                pdf.text('‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 105, 15, { align: 'center' });
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'normal');
                pdf.text(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}`, 105, 22, { align: 'center' });
                
                // Add admin panel image
                const maxHeight = 260; // Maximum height for A4
                const finalHeight = Math.min(adminImgHeight, maxHeight);
                pdf.addImage(adminImgData, 'PNG', 10, 30, adminImgWidth, finalHeight);
                
                // Capture Dashboard
                const dashboard = document.getElementById('dashboard');
                if (!dashboard) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î');
                }
                
                const dashboardWasHidden = dashboard.classList.contains('hidden');
                if (dashboardWasHidden) {
                    dashboard.classList.remove('hidden');
                    updateDashboard();
                    // Wait for charts to render
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
                
                const dashboardCanvas = await html2canvas(dashboard, {
                    scale: 0.8,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: dashboard.scrollWidth,
                    height: dashboard.scrollHeight,
                    scrollX: 0,
                    scrollY: 0
                });
                
                // Restore dashboard visibility
                if (dashboardWasHidden) {
                    dashboard.classList.add('hidden');
                }
                
                const dashboardImgData = dashboardCanvas.toDataURL('image/png', 0.8);
                const dashboardImgWidth = 190;
                const dashboardImgHeight = (dashboardCanvas.height * dashboardImgWidth) / dashboardCanvas.width;
                
                // Add second page - Dashboard
                pdf.addPage();
                pdf.setFontSize(18);
                pdf.setFont('helvetica', 'bold');
                pdf.text('‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£', 105, 15, { align: 'center' });
                pdf.setFontSize(10);
                pdf.setFont('helvetica', 'normal');
                pdf.text(`‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${new Date().toLocaleString('th-TH')}`, 105, 22, { align: 'center' });
                
                // Add dashboard image (may need multiple pages if too long)
                let yPosition = 30;
                let remainingHeight = dashboardImgHeight;
                let sourceY = 0;
                
                while (remainingHeight > 0) {
                    const pageHeight = Math.min(remainingHeight, maxHeight);
                    const sourceHeight = (pageHeight * dashboardCanvas.height) / dashboardImgHeight;
                    
                    // Create a temporary canvas for this section
                    const tempCanvas = document.createElement('canvas');
                    tempCanvas.width = dashboardCanvas.width;
                    tempCanvas.height = sourceHeight;
                    const tempCtx = tempCanvas.getContext('2d');
                    
                    tempCtx.drawImage(
                        dashboardCanvas, 
                        0, sourceY, dashboardCanvas.width, sourceHeight,
                        0, 0, dashboardCanvas.width, sourceHeight
                    );
                    
                    const tempImgData = tempCanvas.toDataURL('image/png', 0.8);
                    pdf.addImage(tempImgData, 'PNG', 10, yPosition, dashboardImgWidth, pageHeight);
                    
                    remainingHeight -= pageHeight;
                    sourceY += sourceHeight;
                    
                    if (remainingHeight > 0) {
                        pdf.addPage();
                        yPosition = 10;
                    }
                }
                
                // Generate filename
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const filename = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£_${year}-${month}-${day}_${hours}-${minutes}.pdf`;
                
                // Save the PDF
                pdf.save(filename);
                
                alert(`‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n\nüìÅ ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: ${filename}\nüìÑ ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤: ${pdf.getNumberOfPages()}\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleString('th-TH')}\n\nüí° ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå Downloads`);
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert(`‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á PDF\n\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î: ${error.message}\n\n‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:\n- ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà\n- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô\n- ‡∏•‡∏≠‡∏á‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥`);
            }
        }

        // Update last update time
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('th-TH');
            document.getElementById('lastUpdate').textContent = timeString;
        }

        // Company data management
        function handleLogoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (2MB limit)
            if (file.size > 2 * 1024 * 1024) {
                alert('‚ùå ‡πÑ‡∏ü‡∏•‡πå‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 2MB)');
                return;
            }
            
            // Check file type
            if (!file.type.startsWith('image/')) {
                alert('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const logoData = e.target.result;
                companyData.logo = logoData;
                
                // Update preview
                const preview = document.getElementById('logoPreview');
                preview.innerHTML = `<img src="${logoData}" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" class="w-32 h-32 mx-auto object-contain rounded-lg border">`;
                
                // Show remove button
                document.getElementById('removeLogoBtn').classList.remove('hidden');
                
                // Auto save
                saveCompanyData();
                updateCompanyDisplay();
            };
            reader.readAsDataURL(file);
        }
        
        function removeLogo() {
            companyData.logo = null;
            
            // Reset preview
            const preview = document.getElementById('logoPreview');
            preview.innerHTML = `
                <div class="w-32 h-32 mx-auto bg-gray-200 rounded-lg flex items-center justify-center">
                    <span class="text-gray-500 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏•‡πÇ‡∏Å‡πâ</span>
                </div>
            `;
            
            // Hide remove button
            document.getElementById('removeLogoBtn').classList.add('hidden');
            
            // Reset file input
            document.getElementById('logoInput').value = '';
            
            // Auto save
            saveCompanyData();
            updateCompanyDisplay();
        }
        
        function saveCompanyInfo() {
            // Get form data
            companyData.name = document.getElementById('companyName').value.trim();
            companyData.projectName = document.getElementById('projectName').value.trim();
            
            // Save to localStorage
            saveCompanyData();
            updateCompanyDisplay();
            
            // Show success message
            const button = document.getElementById('saveCompanyInfo');
            const originalText = button.innerHTML;
            button.innerHTML = '‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!';
            button.className = 'bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all';
            
            setTimeout(() => {
                button.innerHTML = originalText;
                button.className = 'bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white px-6 py-3 rounded-lg font-semibold shadow-lg transform hover:scale-105 transition-all';
            }, 2000);
        }
        
        function updateCompanyDisplay() {
            // Update dashboard display
            const logoElement = document.getElementById('dashboardLogo');
            const nameElement = document.getElementById('dashboardCompanyName');
            const projectElement = document.getElementById('dashboardProjectName');
            
            // Check if elements exist (for client view)
            if (logoElement && nameElement && projectElement) {
                // Update logo
                if (companyData.logo) {
                    logoElement.innerHTML = `<img src="${companyData.logo}" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" class="w-16 h-16 object-contain rounded-xl">`;
                    logoElement.className = 'w-16 h-16 bg-white bg-opacity-20 rounded-xl flex items-center justify-center border-2 border-white border-opacity-30 shadow-lg backdrop-blur-sm overflow-hidden';
                } else {
                    logoElement.innerHTML = '<span class="text-white text-xs">‡πÇ‡∏•‡πÇ‡∏Å‡πâ</span>';
                    logoElement.className = 'w-16 h-16 bg-white bg-opacity-20 rounded-xl flex items-center justify-center border-2 border-white border-opacity-30 shadow-lg backdrop-blur-sm';
                }
                
                // Update company info
                nameElement.textContent = companyData.name || '‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó';
                projectElement.textContent = companyData.projectName || '‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£';
                
                console.log('‚úÖ ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÉ‡∏ô‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î:', {
                    name: companyData.name,
                    project: companyData.projectName,
                    hasLogo: !!companyData.logo
                });
            }
            
            // Update form fields (only if in admin view)
            const companyNameInput = document.getElementById('companyName');
            const projectNameInput = document.getElementById('projectName');
            if (companyNameInput && projectNameInput) {
                companyNameInput.value = companyData.name || '';
                projectNameInput.value = companyData.projectName || '';
            }
            
            // Update logo preview (only if in admin view)
            const preview = document.getElementById('logoPreview');
            if (preview) {
                if (companyData.logo) {
                    preview.innerHTML = `<img src="${companyData.logo}" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó" class="w-32 h-32 mx-auto object-contain rounded-lg border">`;
                    const removeBtn = document.getElementById('removeLogoBtn');
                    if (removeBtn) removeBtn.classList.remove('hidden');
                } else {
                    preview.innerHTML = `
                        <div class="w-32 h-32 mx-auto bg-gray-200 rounded-lg flex items-center justify-center">
                            <span class="text-gray-500 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÇ‡∏•‡πÇ‡∏Å‡πâ</span>
                        </div>
                    `;
                    const removeBtn = document.getElementById('removeLogoBtn');
                    if (removeBtn) removeBtn.classList.add('hidden');
                }
            }
        }
        
        function saveCompanyData() {
            localStorage.setItem('companyData', JSON.stringify(companyData));
        }
        
        function loadCompanyData() {
            const saved = localStorage.getItem('companyData');
            if (saved) {
                try {
                    companyData = JSON.parse(saved);
                    console.log('üìÇ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', {
                        name: companyData.name,
                        project: companyData.projectName,
                        hasLogo: !!companyData.logo
                    });
                } catch (error) {
                    console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:', error);
                    companyData = {
                        logo: null,
                        name: '',
                        projectName: ''
                    };
                }
            } else {
                console.log('üìù ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡πÄ‡∏Å‡πà‡∏≤ - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà');
                companyData = {
                    logo: null,
                    name: '',
                    projectName: ''
                };
            }
        }

        // Auto-save functionality
        let autoSaveTimeout;
        function autoSaveProgress() {
            // Clear previous timeout
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }
            
            // Set new timeout to save after 1 second of inactivity
            autoSaveTimeout = setTimeout(() => {
                saveProgressData();
                console.log('‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß');
                
                // Show brief save indicator
                showSaveIndicator();
            }, 1000);
        }
        
        function showSaveIndicator() {
            // Create or update save indicator
            let indicator = document.getElementById('autoSaveIndicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'autoSaveIndicator';
                indicator.className = 'fixed top-4 right-4 bg-green-500 text-white px-3 py-2 rounded-lg shadow-lg z-50 text-sm transform translate-x-full transition-transform duration-300';
                indicator.innerHTML = 'üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß';
                document.body.appendChild(indicator);
            }
            
            // Show indicator
            indicator.classList.remove('translate-x-full');
            
            // Hide after 2 seconds
            setTimeout(() => {
                indicator.classList.add('translate-x-full');
            }, 2000);
        }

        // Save/Load data
        function saveProgressData() {
            try {
                localStorage.setItem('constructionProgress', JSON.stringify(progressData));
                localStorage.setItem('lastSaveTime', new Date().toISOString());
                console.log('üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß:', Object.keys(progressData).length, '‡∏´‡∏°‡∏ß‡∏î‡∏á‡∏≤‡∏ô');
            } catch (error) {
                console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
            }
        }

        function loadProgressData() {
            const saved = localStorage.getItem('constructionProgress');
            if (saved) {
                try {
                    progressData = JSON.parse(saved);
                    const lastSave = localStorage.getItem('lastSaveTime');
                    if (lastSave) {
                        console.log('üìÇ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:', new Date(lastSave).toLocaleString('th-TH'));
                    }
                } catch (error) {
                    console.error('‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', error);
                    progressData = {};
                }
            } else {
                console.log('üìù ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤ - ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡∏°‡πà');
                progressData = {};
            }
        }

        // Initialize app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97820abed352272d',t:'MTc1NjcwMTEyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
